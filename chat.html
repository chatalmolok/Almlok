<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>شات الملوك 👑</title>
<link rel="stylesheet" href="style.css">

<style>
body {
  margin: 0;
  font-family: "Cairo", sans-serif;
  background: linear-gradient(135deg, #000000, #1a1a1a);
  color: #fff;
  overflow: hidden;
}

#loadingScreen {
  position: fixed;
  inset: 0;
  background: #000;
  color: #FFD700;
  font-size: 22px;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 999;
  animation: glow 1.5s ease-in-out infinite alternate;
}
@keyframes glow {
  from { text-shadow: 0 0 10px #FFD700; }
  to { text-shadow: 0 0 25px #FFD700, 0 0 35px #FFA500; }
}

.header {
  background: rgba(255, 215, 0, 0.1);
  backdrop-filter: blur(10px);
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 15px;
  border-bottom: 2px solid #FFD700;
}

.header h1 {
  color: #FFD700;
  font-size: 20px;
  text-shadow: 0 0 10px #FFD700;
}

.profile-btn {
  background: none;
  border: none;
  cursor: pointer;
  color: #FFD700;
  font-size: 26px;
  transition: transform 0.3s;
}
.profile-btn:hover {
  transform: scale(1.2);
}

.profile-box {
  position: fixed;
  top: 20px;
  left: 20px;
  background: rgba(20,20,20,0.95);
  border: 1px solid #FFD700;
  padding: 20px;
  border-radius: 15px;
  display: none;
  z-index: 998;
  box-shadow: 0 0 25px #FFD700;
  width: 260px;
}

.profile-box.active {
  display: block;
}

.profile-box input {
  width: 100%;
  margin: 5px 0;
  padding: 8px;
  border-radius: 8px;
  border: 1px solid #FFD700;
  background: #000;
  color: #FFD700;
}

.profile-box button {
  background: #FFD700;
  color: #000;
  border: none;
  padding: 8px 10px;
  width: 100%;
  border-radius: 8px;
  cursor: pointer;
}

#closeProfile {
  position: absolute;
  top: 8px;
  left: 8px;
  background: transparent;
  color: #FFD700;
  border: none;
  font-size: 18px;
  cursor: pointer;
}

.chat-area {
  height: calc(100vh - 60px);
  overflow-y: auto;
  padding: 15px;
}

.message {
  background: rgba(255, 215, 0, 0.1);
  border-left: 3px solid #FFD700;
  margin: 10px 0;
  padding: 10px;
  border-radius: 10px;
}

input#msgInput {
  width: 80%;
  padding: 10px;
  border: 1px solid #FFD700;
  border-radius: 10px;
  background: #111;
  color: #FFD700;
}

button#sendBtn {
  background: #FFD700;
  color: #000;
  padding: 10px 15px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  margin-left: 10px;
}
</style>
</head>
<body>

<div id="loadingScreen">👑 جاري تحميل شات الملوك...</div>

<header class="header">
  <h1>شات الملوك الرسمي 👑</h1>
  <button class="profile-btn" id="openProfile">👤</button>
</header>

<div class="profile-box" id="profileBox">
  <button id="closeProfile">✖</button>
  <h3 style="color:#FFD700;text-align:center;">الملف الشخصي</h3>
  <input type="text" id="profileName" placeholder="الاسم">
  <input type="number" id="profileAge" placeholder="العمر">
  <select id="profileGender">
    <option value="">اختر الجنس</option>
    <option value="ذكر">ذكر</option>
    <option value="انثى">أنثى</option>
  </select>
  <input type="text" id="profileBio" placeholder="نبذة مختصرة">
  <button id="saveProfile">حفظ التعديلات</button>
</div>

<div class="chat-area" id="chatArea"></div>

<div style="position:fixed;bottom:10px;width:100%;text-align:center;">
  <input type="text" id="msgInput" placeholder="اكتب رسالتك هنا...">
  <button id="sendBtn">إرسال</button>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDJhA1WkFsLZiQz5WZFWPFbdjxLPtG57ss",
    authDomain: "lloo-756f7.firebaseapp.com",
    projectId: "lloo-756f7",
    storageBucket: "lloo-756f7.firebasestorage.app",
    messagingSenderId: "951071688513",
    appId: "1:951071688513:web:46f402720b38f15c5043c0"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const loadingScreen = document.getElementById("loadingScreen");
  const profileBox = document.getElementById("profileBox");
  const openProfile = document.getElementById("openProfile");
  const closeProfile = document.getElementById("closeProfile");

  openProfile.onclick = () => profileBox.classList.add("active");
  closeProfile.onclick = () => profileBox.classList.remove("active");

  onAuthStateChanged(auth, async (user) => {
    loadingScreen.style.display = "none";
    if (!user) {
      window.location.href = "login.html";
      return;
    }

    const userRef = doc(db, "users", user.uid);
    const snap = await getDoc(userRef);
    if (snap.exists()) {
      const data = snap.data();
      document.getElementById("profileName").value = data.name || "";
      document.getElementById("profileAge").value = data.age || "";
      document.getElementById("profileGender").value = data.gender || "";
      document.getElementById("profileBio").value = data.bio || "";
    }
  });

  document.getElementById("saveProfile").addEventListener("click", async () => {
    const user = auth.currentUser;
    if (!user) return alert("يرجى تسجيل الدخول أولاً");
    await setDoc(doc(db, "users", user.uid), {
      name: document.getElementById("profileName").value,
      age: document.getElementById("profileAge").value,
      gender: document.getElementById("profileGender").value,
      bio: document.getElementById("profileBio").value
    });
    alert("تم حفظ الملف الشخصي بنجاح ✅");
  });
</script>

</body>
</html>